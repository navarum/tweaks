#!/bin/zsh
# NE 17 Apr 2020
# Helper to allocate numbered i3 workspaces evenly between available monitors

confg=~/.i3/output.conf.gen

mons=($(xrandr --listactivemonitors |
        grep -v Monitors: | awk '{print $4}'))
# https://faq.i3wm.org/question/6200/obtain-info-on-current-workspace-etc.1.html
curr=$(i3-msg -t get_workspaces \
  | jq '.[] | select(.focused==true).name' \
  | cut -d"\"" -f2)

echo "# DO NOT EDIT" > $confg
echo "# AUTOMATICALLY GENERATED BY i3-divide-workspaces-2" >> $confg
for i in $(seq 1 10); do
    out=$mons[$[ 1+(i % $#mons) ]];
#    echo i=$i out=$out
    i3-msg "workspace $i, move workspace to output $out";
    echo "workspace $i output $out" >> $confg
done

i3-msg restart
echo curr=$curr
#sleep 0.2
i3-msg "workspace $curr"
